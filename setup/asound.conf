# =============================================================================
# ALSA Virtual Device Configuration for ICUSBAUDIO7D (CM106 7.1 USB)
# =============================================================================
# Creates individual MONO and STEREO virtual outputs from the 8-channel
# USB sound card (hw:1,0). Each can be used by a separate Snapclient.
#
# Install: cp asound.conf /etc/asound.conf && alsactl kill rescan
#
# Channel mapping (CM106 7.1):
#   Ch 0 = Front Left      Ch 1 = Front Right
#   Ch 2 = Rear Left       Ch 3 = Rear Right
#   Ch 4 = Center          Ch 5 = LFE/Sub
#   Ch 6 = Side Left       Ch 7 = Side Right
#
# MONO outputs:   usb_ch0 ... usb_ch7   (1 speaker per room)
# STEREO outputs: usb_stereo01, usb_stereo23, usb_stereo45, usb_stereo67
# Onboard:        onboard (ALC1220 Analog, hw:0,0)
# =============================================================================

# ---------- dmix: shared mixing device for concurrent access -----------------
pcm.usb_dmix {
    type dmix
    ipc_key 1024
    ipc_perm 0666
    slave {
        pcm "hw:1,0"
        rate 48000
        channels 8
        period_size 1024
        buffer_size 4096
    }
}

# =============================================================================
# MONO outputs — one channel each (input mono → single output channel)
# =============================================================================

pcm.usb_ch0 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.0 1.0 }    # mono → Front Left
}

pcm.usb_ch1 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.1 1.0 }    # mono → Front Right
}

pcm.usb_ch2 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.2 1.0 }    # mono → Rear Left
}

pcm.usb_ch3 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.3 1.0 }    # mono → Rear Right
}

pcm.usb_ch4 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.4 1.0 }    # mono → Center
}

pcm.usb_ch5 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.5 1.0 }    # mono → LFE/Sub
}

pcm.usb_ch6 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.6 1.0 }    # mono → Side Left
}

pcm.usb_ch7 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable { 0.7 1.0 }    # mono → Side Right
}

# =============================================================================
# STEREO outputs — channel pairs (input L/R → two adjacent output channels)
# =============================================================================

pcm.usb_stereo01 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable {
        0.0 1.0    # left  → Front Left
        1.1 1.0    # right → Front Right
    }
}

pcm.usb_stereo23 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable {
        0.2 1.0    # left  → Rear Left
        1.3 1.0    # right → Rear Right
    }
}

pcm.usb_stereo45 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable {
        0.4 1.0    # left  → Center
        1.5 1.0    # right → LFE/Sub
    }
}

pcm.usb_stereo67 {
    type route
    slave { pcm "usb_dmix"; channels 8 }
    ttable {
        0.6 1.0    # left  → Side Left
        1.7 1.0    # right → Side Right
    }
}

# =============================================================================
# Onboard ALC1220 Analog (hw:0,0)
# =============================================================================

pcm.onboard {
    type plug
    slave.pcm "hw:0,0"
}

# ---------- Default ----------------------------------------------------------
pcm.!default {
    type plug
    slave.pcm "usb_stereo01"
}

ctl.!default {
    type hw
    card 1
}
